{% extends 'base.html' %}

{% block title %}Çek Takip Sistemi | AECO{% endblock %}

{% block extra_css %}
<style>
    /* Kart ve Genel Ayarlar */
    .card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; overflow: hidden; }
    .card-header { font-weight: bold; text-transform: uppercase; letter-spacing: 1px; padding: 15px 20px; border: none; }
    
    /* Renk Kodları */
    .bg-danger-subtle { background-color: #ffebee !important; color: #c62828; }
    .bg-warning-subtle { background-color: #fff8e1 !important; color: #f57f17; }
    .bg-success-subtle { background-color: #e8f5e9 !important; color: #2e7d32; }
    .bg-secondary-subtle { background-color: #eceff1 !important; color: #546e7a; }

    .btn-action { width: 140px; font-size: 0.8rem; font-weight: bold; }
    .vade-badge { font-size: 0.9rem; padding: 5px 10px; border-radius: 6px; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 1200px;">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-0"><i class="fas fa-money-check-alt me-2"></i>ÇEK TAKİP MERKEZİ</h2>
            <p class="text-muted">Vadeli ödemelerinizi buradan takip edip kapatabilirsiniz.</p>
        </div>
        <div class="text-end">
            <a href="{% url 'dashboard' %}" class="btn btn-secondary me-2"><i class="fas fa-arrow-left me-1"></i> Dashboard'a Dön</a>
            <div class="badge bg-dark p-3 fs-6">
                TOPLAM BEKLEYEN RİSK: {{ toplam_risk|floatformat:0 }} ₺
            </div>
        </div>
    </div>

    {% if gecikmisler %}
    <div class="card border-danger border-2">
        <div class="card-header bg-danger text-white">
            <i class="fas fa-exclamation-triangle me-2"></i> DİKKAT! VADESİ GEÇMİŞ VE ÖDENMEMİŞ ÇEKLER
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Vade Tarihi</th>
                        <th>Tedarikçi</th>
                        <th>Banka / Şube</th>
                        <th>Çek No</th>
                        <th>Tutar</th>
                        <th class="text-end">İşlem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cek in gecikmisler %}
                    <tr class="table-danger">
                        <td class="fw-bold text-danger">{{ cek.cek_vade_tarihi|date:"d.m.Y" }}</td>
                        <td>{{ cek.tedarikci.firma_unvani }}</td>
                        <td>{{ cek.cek_banka }} / {{ cek.cek_sube }}</td>
                        <td>{{ cek.cek_numarasi }}</td>
                        <td class="fw-bold">{{ cek.tutar|floatformat:2 }} {{ cek.para_birimi }}</td>
                        <td class="text-end">
                            <a href="{% url 'cek_durum_degistir' cek.id %}" class="btn btn-success btn-sm btn-action shadow">
                                <i class="fas fa-check me-1"></i> ÖDENDİ İŞARETLE
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <div class="card">
        <div class="card-header bg-warning-subtle">
            <i class="fas fa-clock me-2"></i> Önümüzdeki 30 Gün İçinde Ödenecekler
        </div>
        <div class="card-body p-0">
            {% if yaklasanlar %}
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Vade Tarihi</th>
                        <th>Kalan Gün</th>
                        <th>Tedarikçi</th>
                        <th>Banka</th>
                        <th>Tutar</th>
                        <th class="text-end">İşlem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cek in yaklasanlar %}
                    <tr>
                        <td class="fw-bold">{{ cek.cek_vade_tarihi|date:"d.m.Y" }}</td>
                        <td>
                            <span class="badge bg-warning text-dark">Yaklaşıyor</span>
                        </td>
                        <td>{{ cek.tedarikci.firma_unvani }}</td>
                        <td>{{ cek.cek_banka }}</td>
                        <td class="fw-bold">{{ cek.tutar|floatformat:2 }} {{ cek.para_birimi }}</td>
                        <td class="text-end">
                            <a href="{% url 'cek_durum_degistir' cek.id %}" class="btn btn-outline-success btn-sm btn-action">
                                <i class="fas fa-check me-1"></i> ÖDENDİ YAP
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-4 text-center text-muted">Önümüzdeki 30 gün içinde vadesi gelen çek yok. Rahatız. ☕</div>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-success-subtle">
            <i class="fas fa-calendar-alt me-2"></i> İleri Tarihli Çekler (+30 Gün)
        </div>
        <div class="card-body p-0">
            {% if ileri_tarihliler %}
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Vade Tarihi</th>
                        <th>Tedarikçi</th>
                        <th>Tutar</th>
                        <th class="text-end">İşlem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cek in ileri_tarihliler %}
                    <tr>
                        <td>{{ cek.cek_vade_tarihi|date:"d.m.Y" }}</td>
                        <td>{{ cek.tedarikci.firma_unvani }}</td>
                        <td>{{ cek.tutar|floatformat:2 }} {{ cek.para_birimi }}</td>
                        <td class="text-end">
                            <a href="{% url 'cek_durum_degistir' cek.id %}" class="btn btn-outline-success btn-sm btn-action">
                                <i class="fas fa-check me-1"></i> ÖDENDİ YAP
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-4 text-center text-muted">İleri tarihli bekleyen çek yok.</div>
            {% endif %}
        </div>
    </div>

    <div class="card opacity-75">
        <div class="card-header bg-secondary text-white">
            <i class="fas fa-history me-2"></i> Ödenmiş / Kapanmış Çek Arşivi
        </div>
        <div class="card-body p-0">
            <table class="table table-sm table-striped mb-0 text-muted">
                <thead>
                    <tr>
                        <th>Vade</th>
                        <th>Ödenen Firma</th>
                        <th>Tutar</th>
                        <th class="text-end">Durum</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cek in odenmisler %}
                    <tr>
                        <td>{{ cek.cek_vade_tarihi|date:"d.m.Y" }}</td>
                        <td>{{ cek.tedarikci.firma_unvani }}</td>
                        <td>{{ cek.tutar|floatformat:2 }} {{ cek.para_birimi }}</td>
                        <td class="text-end">
                            <span class="badge bg-success">✅ ÖDENDİ</span>
                            <a href="{% url 'cek_durum_degistir' cek.id %}" class="btn btn-link btn-sm text-decoration-none p-0 ms-2" title="Geri Al">↩️</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}