{% extends 'base.html' %}
{% load humanize %}

{% block title %}Çek Takip Sistemi | AECO{% endblock %}

{% block extra_css %}
<style>
    .card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; overflow: hidden; }
    .card-header { font-weight: bold; text-transform: uppercase; letter-spacing: 1px; padding: 15px 20px; border: none; }
    .btn-action { width: 140px; font-size: 0.8rem; font-weight: bold; }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-0 text-dark"><i class="fas fa-money-check-alt me-2 text-primary"></i>ÇEK TAKİP MERKEZİ</h2>
            <p class="text-muted small mb-0">Vadeli ödemelerinizi buradan takip edip kapatabilirsiniz.</p>
        </div>
        <div class="text-end">
            <a href="{% url 'odeme_dashboard' %}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-arrow-left me-1"></i> Finans Paneli
            </a>
            <div class="badge bg-dark p-3 fs-6 shadow-sm">
                TOPLAM RİSK: {{ toplam_risk|floatformat:2|intcomma }} ₺
            </div>
        </div>
    </div>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}

    {% if gecikmisler %}
    <div class="card border-danger border-2 shadow">
        <div class="card-header bg-danger text-white">
            <i class="fas fa-exclamation-triangle me-2"></i> DİKKAT! VADESİ GEÇMİŞ ÇEKLER
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
                <thead class="bg-light text-muted small text-uppercase">
                    <tr>
                        <th class="ps-3">Vade Tarihi</th>
                        <th>Tedarikçi</th>
                        <th>Banka / Şube</th>
                        <th>Çek No</th>
                        <th class="text-end">Tutar</th>
                        <th class="text-end pe-3">İşlem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cek in gecikmisler %}
                    <tr class="table-danger">
                        <td class="ps-3 fw-bold text-danger">{{ cek.vade_tarihi|date:"d.m.Y" }}</td>
                        <td class="fw-bold">{{ cek.tedarikci.firma_unvani }}</td>
                        <td>{{ cek.banka_adi|default:"-" }}</td>
                        <td>{{ cek.cek_no|default:"-" }}</td>
                        <td class="text-end fw-bold fs-6">{{ cek.tutar|floatformat:2|intcomma }} {{ cek.para_birimi }}</td>
                        <td class="text-end pe-3">
                            <a href="{% url 'cek_durum_degistir' cek.id %}" class="btn btn-success btn-sm btn-action shadow-sm">
                                <i class="fas fa-check me-1"></i> ÖDENDİ İŞARETLE
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <div class="card shadow-sm">
        <div class="card-header bg-warning-subtle text-dark border-0">
            <i class="fas fa-clock me-2"></i> Önümüzdeki 30 Gün İçinde Ödenecekler
        </div>
        <div class="table-responsive">
            {% if yaklasanlar %}
            <table class="table table-hover mb-0 align-middle">
                <thead class="bg-light text-muted small text-uppercase">
                    <tr>
                        <th class="ps-3">Vade Tarihi</th>
                        <th>Durum</th>
                        <th>Tedarikçi</th>
                        <th>Banka</th>
                        <th class="text-end">Tutar</th>
                        <th class="text-end pe-3">İşlem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cek in yaklasanlar %}
                    <tr>
                        <td class="ps-3 fw-bold text-dark">{{ cek.vade_tarihi|date:"d.m.Y" }}</td>
                        <td>
                            <span class="badge bg-warning text-dark border border-warning">Yaklaşıyor</span>
                        </td>
                        <td>{{ cek.tedarikci.firma_unvani }}</td>
                        <td class="small text-muted">{{ cek.banka_adi|default:"-" }}</td>
                        <td class="text-end fw-bold text-dark">{{ cek.tutar|floatformat:2|intcomma }} {{ cek.para_birimi }}</td>
                        <td class="text-end pe-3">
                            <a href="{% url 'cek_durum_degistir' cek.id %}" class="btn btn-outline-success btn-sm btn-action">
                                <i class="fas fa-check me-1"></i> ÖDENDİ YAP
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-5 text-center text-muted">
                <i class="fas fa-mug-hot fa-3x mb-3 text-secondary opacity-25"></i>
                <p class="mb-0">Önümüzdeki 30 gün içinde vadesi gelen çek bulunmuyor.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-success-subtle text-dark border-0">
            <i class="fas fa-calendar-alt me-2"></i> İleri Tarihli Çekler (+30 Gün)
        </div>
        <div class="table-responsive">
            {% if ileri_tarihliler %}
            <table class="table table-hover mb-0 align-middle">
                <thead class="bg-light text-muted small text-uppercase">
                    <tr>
                        <th class="ps-3">Vade Tarihi</th>
                        <th>Tedarikçi</th>
                        <th>Banka</th>
                        <th class="text-end">Tutar</th>
                        <th class="text-end pe-3">İşlem</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cek in ileri_tarihliler %}
                    <tr>
                        <td class="ps-3 text-muted">{{ cek.vade_tarihi|date:"d.m.Y" }}</td>
                        <td>{{ cek.tedarikci.firma_unvani }}</td>
                        <td class="small text-muted">{{ cek.banka_adi|default:"-" }}</td>
                        <td class="text-end fw-bold text-muted">{{ cek.tutar|floatformat:2|intcomma }} {{ cek.para_birimi }}</td>
                        <td class="text-end pe-3">
                            <a href="{% url 'cek_durum_degistir' cek.id %}" class="btn btn-outline-secondary btn-sm btn-action">
                                <i class="fas fa-check me-1"></i> ÖDENDİ YAP
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-4 text-center text-muted small">İleri tarihli bekleyen çek yok.</div>
            {% endif %}
        </div>
    </div>

    <div class="card opacity-75 shadow-sm border-0">
        <div class="card-header bg-secondary text-white border-0">
            <i class="fas fa-history me-2"></i> Ödenmiş / Kapanmış Çek Arşivi
        </div>
        <div class="table-responsive">
            <table class="table table-sm table-striped mb-0 text-muted align-middle">
                <thead class="bg-light small">
                    <tr>
                        <th class="ps-3">Vade</th>
                        <th>Ödenen Firma</th>
                        <th class="text-end">Tutar</th>
                        <th class="text-end pe-3">Durum</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cek in odenmisler %}
                    <tr>
                        <td class="ps-3">{{ cek.vade_tarihi|date:"d.m.Y" }}</td>
                        <td>{{ cek.tedarikci.firma_unvani }}</td>
                        <td class="text-end">{{ cek.tutar|floatformat:2|intcomma }} {{ cek.para_birimi }}</td>
                        <td class="text-end pe-3">
                            <span class="badge bg-success me-2">✅ ÖDENDİ</span>
                            <a href="{% url 'cek_durum_degistir' cek.id %}" class="btn btn-link btn-sm text-decoration-none p-0 text-muted" title="Geri Al (Bekleyene Çevir)">
                                <i class="fas fa-undo"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-3 small">Henüz kapanmış bir çek kaydı yok.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}